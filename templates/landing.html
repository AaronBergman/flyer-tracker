<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>{{ link.description or link.slug }}</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", system-ui, sans-serif;
            display: flex; justify-content: center; align-items: center;
            min-height: 100vh; background: #fafafa; color: #333;
        }
        .wrap { text-align: center; padding: 2rem; }
        p { font-size: 1rem; margin-bottom: .5rem; }
        a { color: #555; }
    </style>
</head>
<body>
    <div class="wrap">
        <p>{{ link.description or "Thanks for visiting!" }}</p>
        {% if link.target_url %}
        <p><a href="{{ link.target_url }}">Continue &rarr;</a></p>
        {% endif %}
    </div>

    <script>
        (function () {
            var scanId = {{ scan_id | tojson }};
            var slug = {{ link.slug | tojson }};

            if ("geolocation" in navigator) {
                navigator.geolocation.getCurrentPosition(
                    function (pos) {
                        fetch("/t/" + slug + "/geo", {
                            method: "POST",
                            headers: { "Content-Type": "application/json" },
                            body: JSON.stringify({
                                scan_id: scanId,
                                lat: pos.coords.latitude,
                                lng: pos.coords.longitude,
                                accuracy: pos.coords.accuracy
                            })
                        });
                    },
                    function () { /* denied or error â€” IP geo still logged */ },
                    { enableHighAccuracy: true, timeout: 10000 }
                );
            }
        })();
    </script>
</body>
</html>
